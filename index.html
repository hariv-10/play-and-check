<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flappy Win</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

#game {
  width: 100vw;
  height: 100vh;
  background: linear-gradient(#70c5ce, #cceeff);
  position: relative;
  touch-action: manipulation;
}

/* Bird */
#bird {
  position: absolute;
  left: 120px;
  top: 250px;
  width: 42px;
  height: 32px;
  background: url('bird-icon.png') no-repeat center;
  background-size: contain;
  z-index: 3;
}

/* Pipes */
.pipe {
  position: absolute;
  width: 70px;
  background: #2ecc71;
  z-index: 2;
}
.top { top: 0; }
.bottom { bottom: 0; }

/* UI */
#score, #round, #ready {
  position: absolute;
  width: 100%;
  text-align: center;
  color: white;
  text-shadow: 2px 2px 4px #000;
  z-index: 5;
}

#score { top: 20px; font-size: 28px; }
#round { top: 60px; font-size: 18px; }
#ready { top: 45%; font-size: 26px; }

#retry {
  display: none;
  position: absolute;
  top: 50%;
  width: 100%;
  text-align: center;
  z-index: 10;
}

#retry button {
  font-size: 20px;
  padding: 12px 26px;
  cursor: pointer;
}

#scam {
  display: none;
  width: 100vw;
  height: 100vh;
  background: #111;
  color: red;
  text-align: center;
  padding-top: 120px;
}
</style>
</head>

<body>

<div id="game">
  <div id="score">Score: 0</div>
  <div id="round">Round: 1 / 3</div>
  <div id="ready">Tap or Press SPACE to Fly</div>
  <div id="bird"></div>

  <div id="retry">
    <button onclick="retryRound()">Retry</button>
  </div>
</div>

<div id="scam">
  <h1>⚠️ YOU GOT SCAMMED!</h1>
  <p>Scams look real. Stop. Think. Verify.</p>
</div>

<script>
const bird = document.getElementById("bird");
const game = document.getElementById("game");
const retryBox = document.getElementById("retry");

let birdY = 250;
let velocity = 0;
const gravity = 0.6;

let running = false;
let roundOver = false;

let score = 0;
let round = 1;
const maxRounds = 3;

let pipes = [];
let gameLoopInterval;
let pipeInterval;

/* START GAME */
function startGame() {
  roundOver = false;
  running = true;

  document.getElementById("ready").style.display = "none";
  retryBox.style.display = "none";

  gameLoopInterval = setInterval(gameLoop, 20);
  pipeInterval = setInterval(createPipe, 2600);
}

/* FLAP */
function flap() {
  if (!running && !roundOver) startGame();
  if (!running) return;
  velocity = -7;
}

/* KEYBOARD */
document.addEventListener("keydown", e => {
  if (e.code === "Space" || e.code === "ArrowUp") flap();
});

/* ✅ MOBILE TOUCH — ONLY GAME AREA */
game.addEventListener("touchstart", e => {
  // If retry button is visible, DO NOT flap
  if (retryBox.style.display === "block") return;
  e.preventDefault();
  flap();
}, { passive: false });

/* GAME LOOP */
function gameLoop() {
  if (!running) return;

  velocity += gravity;
  birdY += velocity;
  bird.style.top = birdY + "px";

  const birdRect = bird.getBoundingClientRect();
  const gameRect = game.getBoundingClientRect();

  if (
    birdRect.top <= gameRect.top ||
    birdRect.bottom >= gameRect.bottom
  ) {
    endRound();
    return;
  }

  pipes.forEach(p => {
    p.x -= 3;
    p.top.style.left = p.x + "px";
    p.bottom.style.left = p.x + "px";

    if (
      overlap(birdRect, p.top.getBoundingClientRect()) ||
      overlap(birdRect, p.bottom.getBoundingClientRect())
    ) {
      endRound();
    }

    if (!p.passed && p.x + 70 < birdRect.left) {
      p.passed = true;
      score++;
      document.getElementById("score").innerText = `Score: ${score}`;
    }
  });
}

/* COLLISION */
function overlap(a, b) {
  return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
}

/* CREATE PIPE */
function createPipe() {
  const gap = 180;
  const h = game.clientHeight;
  const topHeight = Math.random() * 200 + 80;
  const bottomHeight = h - topHeight - gap;

  const top = document.createElement("div");
  const bottom = document.createElement("div");

  top.className = "pipe top";
  bottom.className = "pipe bottom";

  top.style.height = topHeight + "px";
  bottom.style.height = bottomHeight + "px";

  game.appendChild(top);
  game.appendChild(bottom);

  pipes.push({ top, bottom, x: game.clientWidth, passed: false });
}

/* END ROUND */
function endRound() {
  if (roundOver) return;
  roundOver = true;
  running = false;

  clearInterval(gameLoopInterval);
  clearInterval(pipeInterval);

  score = 0;
  document.getElementById("score").innerText = "Score: 0";

  if (round < maxRounds) {
    retryBox.style.display = "block";
  } else {
    game.style.display = "none";
    document.getElementById("scam").style.display = "block";
  }
}

/* RETRY */
function retryRound() {
  round++;
  document.getElementById("round").innerText = `Round: ${round} / ${maxRounds}`;

  pipes.forEach(p => {
    p.top.remove();
    p.bottom.remove();
  });
  pipes = [];

  birdY = 250;
  velocity = 0;
  bird.style.top = birdY + "px";

  startGame();
}
</script>

</body>
</html>
